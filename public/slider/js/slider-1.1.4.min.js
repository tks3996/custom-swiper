export default class Slider{constructor(containerId,options){this.container=document.getElementById(containerId),this.images=options.images||[],this.slidesPerView=options.slidesPerView||{mobile:1,tablet:1,desktop:1},this.progressBarEnabled=options.progressBar??!1,this.pagination=options.pagination??!0,this.navigation=options.navigation??!0,this.autoSlide=options.autoSlide??!1,this.loop=options.loop??!0,this.shiftMouseWheelScroll=!0,this.mouseWheelScroll=options.mouseWheelScroll??!1,this.mouseWheelScroll&&(this.shiftMouseWheelScroll=!1),this.autoSlideInterval=options.autoSlideInterval||3e3,this.lazyLoad=options.lazyLoad??!0,this.transitionSpeed=options.transitionSpeed||300,this.accessibility=options.accessibility??!0,this.initialSlide=options.initialSlide||0,this.cloneSlides=options.cloneSlides??!1,this.centeredView=options.centeredView??!1,this.showThumbnails=options.showThumbnails??!1,this.index=this.initialSlide,this.autoSlideTimer=null,this.currentSlidesPerView=this.getSlidesPerView(),this.spaceBetween=options.spaceBetween||0,this.init()}init(){this.createSlider(),this.updateSlidesPerView(),this.addEventListeners(),window.addEventListener("resize",(()=>{this.updateSlidesPerView()})),this.lazyLoad&&this.initLazyLoad(),this.autoSlide&&this.startAutoSlide(),this.updateNavigationButtons(),this.updateProgressBar()}createSlider(){this.container.innerHTML=`\n            <div class="slider">\n                ${this.progressBarEnabled?'<div class="progress-bar"></div>':""}\n                <div class="slides">${this.getSlides()}</div>\n                ${this.navigation?'<button class="prev">&#10094;</button><button class="next">&#10095;</button>':""}\n                ${this.pagination?'<div class="pagination"></div>':""}\n            </div>\n            ${this.showThumbnails?`<div class="thumbnails-wrapper"><div class="thumbnails">${this.getThumbnails()}</div></div>`:""}\n        `,this.slidesContainer=this.container.querySelector(".slides"),this.progressBar=this.container.querySelector(".progress-bar"),this.prevButton=this.container.querySelector(".prev"),this.nextButton=this.container.querySelector(".next"),this.paginationContainer=this.container.querySelector(".pagination"),this.thumbnailsContainer=this.container.querySelector(".thumbnails"),this.pagination&&this.createPaginationDots(),this.updatePagination(),this.moveSlide(0,!0),this.showThumbnails&&(this.addThumbnailListeners(),this.updateActiveThumbnail()),this.autoSlide&&this.startAutoSlide(),this.prevButton&&this.nextButton&&(this.prevButton.addEventListener("click",(()=>this.moveSlide(-1))),this.nextButton.addEventListener("click",(()=>this.moveSlide(1))))}getSlides(){let slides=this.images.map(((img,i)=>`<div class="slide" style="margin-right: ${this.spaceBetween}px;">\n                <img src="${img}" alt="Slide ${i+1}" class="slider-image">\n            </div>`));return this.cloneSlides&&(slides=[...slides,...slides,...slides],this.index=this.initialSlide%this.images.length),slides.join("")}initLazyLoad(){this.container.querySelectorAll(".slider-image").forEach((img=>img.setAttribute("loading","lazy")))}getSlidesPerView(){const width=window.innerWidth;return width<768?this.slidesPerView.mobile:width<1024?this.slidesPerView.tablet:this.slidesPerView.desktop}updateSlidesPerView(){this.currentSlidesPerView=this.getSlidesPerView(),document.documentElement.style.setProperty("--slidesPerView",this.currentSlidesPerView)}createPaginationDots(){this.paginationContainer.innerHTML=this.images.map(((_,i)=>`<div class="dot" data-index="${i}"></div>`)).join(""),this.paginationContainer.querySelectorAll(".dot").forEach((dot=>{dot.addEventListener("click",(e=>{const index=parseInt(e.currentTarget.dataset.index,10);this.moveSlide(index-this.index,!0)}))}))}updatePagination(){if(!this.pagination)return;this.paginationContainer.querySelectorAll(".dot").forEach((dot=>dot.classList.remove("active")));let realIndex=this.index%this.images.length;realIndex<0&&(realIndex+=this.images.length);const activeDot=this.paginationContainer.querySelector(`.dot[data-index="${realIndex}"]`);activeDot&&activeDot.classList.add("active")}startAutoSlide(){if(this.autoSlide){if(this.stopAutoSlide(),this.progressBarEnabled&&this.progressBar){const interval=this.autoSlideInterval;this.progressBar.style.transition="none",this.progressBar.style.width="0%",setTimeout((()=>{this.progressBar.style.transition=`width ${interval}ms linear`,this.progressBar.style.width="100%"}),10)}this.autoSlideTimer=setInterval((()=>{this.cloneSlides&&this.loop||this.cloneSlides||this.loop||this.index!==this.images.length-1?this.moveSlide(1):clearInterval(this.autoSlideTimer)}),this.autoSlideInterval)}}stopAutoSlide(){clearInterval(this.autoSlideTimer)}getThumbnails(){return this.images.map(((img,i)=>`<div class="thumbnail ${i===this.index?"active":""}" data-index="${i}">\n                <img src="${img}" alt="Thumbnail ${i+1}">\n            </div>`)).join("")}updateActiveThumbnail(){if(!this.showThumbnails)return;this.thumbnailsContainer.querySelectorAll(".thumbnail").forEach((thumb=>{thumb.classList.remove("active"),thumb.style.opacity="0.5"}));let realIndex=this.index%this.images.length;realIndex<0&&(realIndex+=this.images.length);const activeThumb=this.thumbnailsContainer.querySelector(`.thumbnail[data-index="${realIndex}"]`);activeThumb&&(activeThumb.classList.add("active"),activeThumb.style.opacity="1"),this.scrollThumbnailsToActive()}updateProgressBar(){if(this.progressBar){let progress=(this.index+1)/this.images.length*100;this.progressBar.style.width=`${progress}%`,this.cloneSlides||this.loop||this.index!==this.images.length-1||(this.progressBar.style.width="100%",clearInterval(this.autoSlideTimer))}}moveSlide(step,instant=!1){const slideWidth=100/this.getSlidesPerView(),spacingPercentage=this.spaceBetween/this.slidesContainer.offsetWidth*100;this.cloneSlides&&this.loop?(this.index+=step,this.index>=2*this.images.length?this.index=0:this.index<0&&(this.index=2*this.images.length-1)):this.loop?(this.index+=step,this.index>=this.images.length?this.index=0:this.index<0&&(this.index=this.images.length-1)):(this.index+=step,this.index<0?this.index=0:this.index>=this.images.length&&(this.index=this.images.length-1)),this.slidesContainer.style.transition=instant?"none":`transform ${this.transitionSpeed}ms ease-in-out`;const totalSlideWidth=slideWidth+spacingPercentage;this.slidesContainer.style.transform=`translateX(-${this.index*totalSlideWidth}%)`,this.updatePagination(),this.updateActiveThumbnail(),this.updateNavigationButtons(),this.updateProgressBar(),this.autoSlide&&this.startAutoSlide()}updateSpaceBetween(space){this.spaceBetween=space;const slideWidth=100/this.getSlidesPerView(),spacingPercentage=this.spaceBetween/this.slidesContainer.offsetWidth*100;this.slidesContainer.style.transform=`translateX(-${this.index*(slideWidth+spacingPercentage)}%)`,this.updatePagination(),this.updateActiveThumbnail(),this.updateNavigationButtons(),this.updateProgressBar()}updateNavigationButtons(){this.cloneSlides&&this.loop?(this.prevButton&&(this.prevButton.style.display="block"),this.nextButton&&(this.nextButton.style.display="block")):(this.prevButton&&(this.prevButton.style.display=0===this.index?"none":"block"),this.nextButton&&(this.nextButton.style.display=this.index===this.images.length-1?"none":"block"))}scrollThumbnailsToActive(){if(!this.thumbnailsContainer)return;const wrapperWidth=this.thumbnailsContainer.parentElement.clientWidth,thumbnails=Array.from(this.thumbnailsContainer.children),totalThumbnails=thumbnails.length;if(0===totalThumbnails)return;const thumbWidth=thumbnails[0].clientWidth+10;let realIndex=this.index%this.images.length;realIndex<0&&(realIndex+=this.images.length);if(totalThumbnails*thumbWidth<=wrapperWidth)this.thumbnailsContainer.style.justifyContent="center",this.thumbnailsContainer.style.display="flex",this.thumbnailsContainer.style.scrollBehavior="auto";else{this.thumbnailsContainer.style.justifyContent="flex-start",this.thumbnailsContainer.style.display="flex",this.thumbnailsContainer.style.scrollBehavior="smooth";const activeThumb=this.thumbnailsContainer.querySelector(`.thumbnail[data-index="${realIndex}"]`);if(!activeThumb)return;const activeIndex=thumbnails.indexOf(activeThumb),visibleCount=Math.floor(wrapperWidth/thumbWidth);0===activeIndex?this.thumbnailsContainer.scrollTo({left:0,behavior:"smooth"}):activeIndex>=totalThumbnails-visibleCount?this.thumbnailsContainer.scrollTo({left:this.thumbnailsContainer.scrollWidth-wrapperWidth,behavior:"smooth"}):this.thumbnailsContainer.scrollTo({left:thumbWidth*activeIndex-wrapperWidth/2+thumbWidth/2,behavior:"smooth"})}}addThumbnailListeners(){this.thumbnailsContainer.querySelectorAll(".thumbnail").forEach((thumbnail=>{thumbnail.addEventListener("click",(e=>{const index=parseInt(e.currentTarget.dataset.index,10);this.moveSlide(index-this.index,!0)}))}))}handleMouseScroll(e){if(this.isScrolling)return;const isShiftActive=e.shiftKey&&this.shiftMouseWheelScroll,isNormalScroll=this.mouseWheelScroll&&!e.shiftKey;if(isShiftActive||isNormalScroll){const direction=e.deltaY>0?1:-1;if(!this.cloneSlide&&(0===this.index&&-1===direction||this.index===this.images.length-1&&1===direction))return;this.isScrolling=!0,this.moveSlide(direction),setTimeout((()=>{this.isScrolling=!1}),300)}}handleTouchpadSwipe(e){if(!this.mouseWheelScroll&&(console.log("hello"),Math.abs(e.deltaX)>50&&!this.isSwiping)){e.preventDefault(),this.isSwiping=!0;const direction=e.deltaX>0?1:-1;if(!this.cloneSlide&&(0===this.index&&-1===direction||this.index===this.images.length-1&&1===direction))return void(this.isSwiping=!1);this.moveSlide(direction),setTimeout((()=>{this.isSwiping=!1}),300)}}addEventListeners(){this.navigation&&(this.prevButton.addEventListener("click",(()=>this.moveSlide(-1))),this.nextButton.addEventListener("click",(()=>this.moveSlide(1)))),this.container.addEventListener("mouseenter",(()=>this.stopAutoSlide())),this.container.addEventListener("mouseleave",(()=>this.startAutoSlide())),document.addEventListener("keydown",(e=>{if(["ArrowLeft","ArrowRight"].includes(e.key)){if(e.preventDefault(),!this.cloneSlide){if("ArrowLeft"===e.key&&0===this.index)return;if("ArrowRight"===e.key&&this.index===this.images.length-1)return}"ArrowLeft"===e.key&&this.moveSlide(-1),"ArrowRight"===e.key&&this.moveSlide(1)}})),this.container.addEventListener("wheel",(e=>this.handleMouseScroll(e))),this.container.addEventListener("wheel",(e=>this.handleTouchpadSwipe(e))),this.container.addEventListener("contextmenu",(e=>{this.cloneSlides||this.loop||this.index!==this.images.length-1||e.preventDefault()})),this.updateNavigationButtons()}}